{% extends "base.html" %}

{% block content %}

<div class="card" style="max-width:900px; margin:auto; padding:30px;">

  <!-- COVER IMAGE -->
  {% if post.cover_image %}
    <img src="{{ post.cover_image.url }}" style="
        width:100%;
        height:360px;
        object-fit:cover;
        border-radius:14px;
        margin-bottom:25px;
    ">
  {% endif %}

  <!-- TITLE -->
  <h1 style="margin-bottom:10px;">{{ post.title }}</h1>

  <!-- META -->
  <div class="profile-meta" style="margin-bottom:20px; color:#666;">
    By <strong>{{ post.author.username }}</strong> â€¢
    {{ post.created_at|date:"M d, Y" }} â€¢
    {{ post.created_at|time:"H:i" }}
  </div>

  <!-- OWNER ACTIONS -->
  {% if user == post.author %}
    <div style="margin-bottom:20px;">
      <a href="{% url 'blog_edit' post.id %}" class="create-btn" style="margin-right:10px;">
        âœï¸ Edit Blog
      </a>

      <form method="post" action="{% url 'blog_delete' post.id %}" style="display:inline;">
        {% csrf_token %}
        <button class="danger-btn">
          ğŸ—‘ Delete
        </button>
      </form>
    </div>
  {% endif %}

  <!-- CONTENT -->
  <div style="
      line-height:1.8;
      font-size:17px;
      color:#222;
  ">
    {{ post.content|safe }}
  </div>
    <!-- LIKE DISLIKE -->
  <div style="margin-top:20px; display:flex; gap:10px;">

    {% if user.is_authenticated %}

      <form method="post" action="{% url 'blog_like' post.id %}">
        {% csrf_token %}
        <button class="create-btn">
          {% if is_liked %}
            ğŸ’” Unlike
          {% else %}
            â¤ï¸ Like
          {% endif %}
          ({{ post.likes.count }})
        </button>
      </form>

      <form method="post" action="{% url 'blog_dislike' post.id %}">
        {% csrf_token %}
        <button class="danger-btn">
          {% if is_disliked %}
            ğŸ”„ Remove Dislike
          {% else %}
            ğŸ‘ Dislike
          {% endif %}
          ({{ post.dislikes.count }})
        </button>
      </form>

    {% else %}
      <p><a href="{% url 'login' %}">Login</a> to react</p>
    {% endif %}

  </div>


</div>

<!-- COMMENTS SECTION -->
<div style="max-width:900px; margin:40px auto;">

  <h3 style="margin-bottom:15px;">ğŸ’¬ Comments</h3>

  {% for comment in comments %}
    <div class="card" style="margin-bottom:12px;">
      <strong>{{ comment.user.username }}</strong>
      <small style="color:#666;">
        â€¢ {{ comment.created_at|date:"M d, Y H:i" }}
      </small>
      <p style="margin-top:8px;">{{ comment.text }}</p>
    </div>
  {% empty %}
    <p style="color:#666;">No comments yet. Be the first one ğŸ‘‡</p>
  {% endfor %}

  <!-- ADD COMMENT -->
  {% if user.is_authenticated %}
    <div class="card" style="margin-top:20px;">
      <h4>Add a comment</h4>

      <form method="post">
        {% csrf_token %}
        {{ form.text }}

        <button class="create-btn" style="margin-top:10px;">
          ğŸ’¬ Post Comment
        </button>
        
      </form>
    </div>
    
  {% else %}
    <p>
      <a href="{% url 'login' %}">Login</a> to add a comment.
    </p>
  {% endif %}

</div>

{% endblock %}
